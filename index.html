<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a0a0a">
    <title>Amorina Cine Bar</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="amorina-icon.png">

    <!-- SEO Meta Tags -->
    <meta name="description"
        content="Amorina Cine Bar - Un espacio para el cine independiente, de autor y clásicos en el corazón de Palermo.">
    <meta name="keywords" content="cine bar, palermo, cine independiente, cartelera, amorina, tita revista">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://amorina.club/">
    <meta property="og:title" content="Amorina Cine Bar">
    <meta property="og:description" content="Un espacio para el cine independiente, de autor y clásicos.">
    <meta property="og:image" content="amorina-icon.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://amorina.club/">
    <meta property="twitter:title" content="Amorina Cine Bar">
    <meta property="twitter:description" content="Un espacio para el cine independiente, de autor y clásicos.">
    <meta property="twitter:image" content="amorina-icon.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=Inter:wght@300;400;500&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --red: #c9586f;
            --red-dark: #a04558;
            --cream: #faf5f0;
            --cream-dark: #f0e8e0;
            --black: #1a1a1a;
            --white: #ffffff;
            --green: #5d8a66;
            --green-light: #7aa882;
        }

        html,
        body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--cream);
            color: var(--black);
        }

        /* ==================== MAIN LAYOUT ==================== */
        /* Desktop: sections vertical, movies horizontal */
        /* Mobile: sections horizontal, movies vertical */

        .app-container {
            width: 100vw;
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
        }

        /* Desktop: Vertical section scrolling */
        .sections-wrapper {
            height: 100%;
            overflow-y: auto;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
            scrollbar-width: none;
        }

        .sections-wrapper::-webkit-scrollbar {
            display: none;
        }

        .section {
            min-height: 100vh;
            min-height: 100dvh;
            scroll-snap-align: start;
            flex-shrink: 0;
            position: relative;
        }

        /* ==================== HEADER ==================== */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--cream);
            pointer-events: none;
            min-height: 80px;
            /* Ensure enough height for alignment */
        }

        .header>* {
            pointer-events: auto;
        }

        .logo-center {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
        }

        .logo-center img {
            height: 60px;
            /* Increased by 20% (was 50px) */
            width: auto;
        }

        .header-icon {
            width: 40px;
            height: 40px;
            background: var(--black);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .header-icon svg {
            width: 20px;
            height: 20px;
        }

        /* ==================== DAY INDICATOR ==================== */
        .day-indicator {
            background: var(--black);
            color: var(--white);
            padding: 10px 18px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 2px;
            box-shadow: 4px 4px 0 var(--red);
            transition: transform 0.3s, opacity 0.3s;
            white-space: nowrap;
        }

        .day-indicator.hidden {
            transform: translateX(-150%);
            opacity: 0;
        }

        /* ==================== NAVIGATION DOTS (Desktop) ==================== */
        .nav-dots {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .nav-dot {
            width: 10px;
            height: 10px;
            border: 2px solid var(--black);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            background: transparent;
        }

        .nav-dot.active {
            background: var(--red);
            border-color: var(--red);
            transform: scale(1.3);
        }

        .nav-dot:hover {
            border-color: var(--red);
        }

        /* ==================== CARTELERA SECTION ==================== */
        #cartelera {
            background: var(--cream);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Movies timeline - HORIZONTAL scroll on DESKTOP */
        .movies-timeline {
            flex: 1;
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            padding: 100px 50vw 40px 24px;
            gap: 24px;
            align-items: stretch;
        }

        .movies-timeline::-webkit-scrollbar {
            display: none;
        }

        /* Day separator in timeline */
        .day-separator {
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0 20px;
            scroll-snap-align: start;
            min-width: 120px;
        }

        .day-separator-date {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            color: var(--red);
            line-height: 1;
        }

        .day-separator-month {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.2rem;
            font-style: italic;
            color: var(--black);
            opacity: 0.6;
        }

        .day-separator-weekday {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            letter-spacing: 2px;
            color: var(--black);
            margin-top: 8px;
            opacity: 0.8;
        }

        .movie-card {
            flex-shrink: 0;
            width: 280px;
            scroll-snap-align: start;
            background: var(--white);
            border: 2px solid var(--black);
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }

        .movie-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 8px 8px 0 var(--black);
        }

        .movie-time-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--black);
            color: var(--white);
            padding: 6px 12px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            letter-spacing: 1px;
            z-index: 2;
        }

        .movie-poster {
            width: 100%;
            height: 350px;
            object-fit: cover;
            border-bottom: 2px solid var(--black);
        }

        .movie-info {
            padding: 16px;
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .movie-director {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 4px;
            font-family: 'Cormorant Garamond', serif;
        }

        .movie-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.4rem;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            line-height: 1.1;
        }

        .movie-meta {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 4px;
        }

        .movie-footer {
            margin-top: auto;
            padding-top: 12px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .movie-price {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            color: var(--black);
        }

        .movie-btn {
            background: var(--green);
            border: none;
            padding: 8px 16px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .movie-btn:hover {
            background: var(--green-light);
        }

        /* ==================== OTHER SECTIONS ==================== */
        #revista {
            background: var(--black);
            color: var(--cream);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 24px;
        }

        .revista-buy-btn {
            margin-top: 40px;
            background: var(--red);
            color: var(--white);
            border: none;
            padding: 16px 32px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            letter-spacing: 1px;
            cursor: pointer;
            transition: transform 0.3s, background 0.3s;
            box-shadow: 4px 4px 0 var(--black);
        }

        .revista-buy-btn:hover {
            background: var(--red-dark);
            transform: translateY(-4px);
        }

        #nosotros {
            background: var(--red);
            color: var(--white);
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 80px 48px;
        }

        #perfil {
            background: var(--cream-dark);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 80px 24px;
        }

        .section-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 4rem;
            letter-spacing: 4px;
            margin-bottom: 24px;
        }

        .section-subtitle {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5rem;
            font-style: italic;
            opacity: 0.8;
            max-width: 600px;
        }

        /* Revista Grid - Simpler horizontal layout */
        .revista-grid {
            display: flex;
            gap: 20px;
            margin-top: 60px;
            padding: 20px;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            max-width: 100%;
        }

        .revista-grid::-webkit-scrollbar {
            display: none;
        }

        .revista-card {
            flex-shrink: 0;
            width: 180px;
            height: 260px;
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            scroll-snap-align: center;
            position: relative;
        }

        .revista-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .revista-card:hover {
            transform: scale(1.08) translateY(-8px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6);
        }

        .revista-label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
            padding: 30px 10px 10px;
            color: var(--cream);
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.8rem;
            letter-spacing: 1px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .revista-card:hover .revista-label {
            opacity: 1;
        }

        /* PDF Reader Modal */
        .pdf-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .pdf-modal.active {
            display: flex;
        }

        .pdf-close {
            position: absolute;
            top: 24px;
            right: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            z-index: 10001;
            transition: color 0.3s;
            font-weight: 300;
            /* Thinner font */
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
        }

        .pdf-close:hover {
            color: var(--white);
            background: rgba(0, 0, 0, 0.8);
        }

        .pdf-container {
            width: 90%;
            max-width: 800px;
            height: 80vh;
            background: var(--cream);
            border-radius: 8px;
            overflow: hidden;
        }

        .pdf-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .pdf-paywall {
            text-align: center;
            padding: 40px;
            background: var(--cream);
            color: var(--black);
        }

        .pdf-paywall h3 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            margin-bottom: 16px;
        }

        .pdf-paywall p {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.2rem;
            margin-bottom: 24px;
        }

        .pdf-paywall button {
            background: var(--red);
            color: var(--white);
            border: none;
            padding: 14px 32px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .revista-grid {
                flex-direction: column;
                align-items: center;
                gap: 20px;
                padding: 20px 16px;
                overflow-x: visible;
                overflow-y: auto;
            }

            .revista-card {
                width: 80vw;
                height: 112vw;
                /* ~1.4 ratio */
            }

            .revista-label {
                font-size: 0.8rem;
                padding: 20px 8px 8px;
            }
        }

        /* Nosotros specific */
        #nosotros .section-title {
            font-size: 5rem;
        }

        #nosotros p {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.3rem;
            line-height: 1.8;
            max-width: 700px;
            margin-top: 24px;
        }

        /* Perfil specific */
        .login-btn {
            background: var(--black);
            color: var(--white);
            border: none;
            padding: 16px 40px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 1px;
            cursor: pointer;
            gap: 12px;
            margin-top: 24px;
            transition: transform 0.2s;
        }

        .login-btn:hover {
            transform: scale(1.05);
        }

        /* Shipping Modal */
        .shipping-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 11000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .shipping-modal.active {
            display: flex;
        }

        .shipping-content {
            background: var(--cream);
            padding: 30px;
            max-width: 450px;
            width: 100%;
            border: 2px solid var(--black);
            box-shadow: 10px 10px 0 var(--black);
            position: relative;
        }

        .shipping-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            margin-bottom: 20px;
            color: var(--black);
        }

        .shipping-option {
            margin-bottom: 15px;
            padding: 15px;
            border: 2px solid #eee;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .shipping-option:hover {
            border-color: var(--red);
        }

        .shipping-option.selected {
            border-color: var(--red);
            background: rgba(201, 88, 111, 0.05);
        }

        .shipping-option input {
            display: none;
        }

        .shipping-fields {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            margin-bottom: 20px;
        }

        .shipping-fields.active {
            max-height: 300px;
        }

        .shipping-input-group {
            margin-bottom: 10px;
        }

        .shipping-input-group label {
            display: block;
            font-size: 0.8rem;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .shipping-input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            font-family: 'Inter', sans-serif;
        }

        .shipping-quote {
            margin-top: 15px;
            padding: 10px;
            background: #f9f9f9;
            border-left: 4px solid var(--green);
            font-size: 0.9rem;
            display: none;
        }

        .shipping-quote.active {
            display: block;
        }

        .shipping-total {
            font-weight: 700;
            color: var(--red);
        }

        .shipping-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .shipping-btn {
            width: 100%;
            padding: 14px;
            background: var(--black);
            color: var(--white);
            border: none;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 20px;
        }

        .shipping-btn:hover {
            background: var(--red);
        }

        .login-btn svg {
            width: 24px;
            height: 24px;
        }

        /* Subscription Cards */
        .subscription-cards {
            display: flex;
            gap: 20px;
            margin-top: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .sub-card {
            width: 200px;
            padding: 24px 20px;
            background: var(--black);
            border: 2px solid transparent;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .sub-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--red), var(--green));
        }

        .sub-card:nth-child(1)::before {
            background: var(--cream-dark);
        }

        .sub-card:nth-child(2)::before {
            background: linear-gradient(90deg, var(--red), #ff8a9e);
        }

        .sub-card:nth-child(3)::before {
            background: linear-gradient(90deg, #ffd700, #ff8c00);
        }

        .sub-card:hover {
            transform: translateY(-8px);
            border-color: var(--red);
        }

        .sub-card-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            color: var(--cream);
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        .sub-card-price {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: var(--red);
            margin-bottom: 16px;
        }

        .sub-card-price.free {
            color: var(--green);
            font-size: 1.5rem;
        }

        .sub-card-benefits {
            list-style: none;
            text-align: left;
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.95rem;
            color: #aaa;
        }

        .sub-card-benefits li {
            padding: 6px 0;
            border-bottom: 1px solid #333;
        }

        .sub-card-benefits li:last-child {
            border-bottom: none;
        }

        .sub-card-benefits li::before {
            content: '✓ ';
            color: var(--green);
        }

        .sub-card-btn {
            margin-top: 20px;
            padding: 10px 24px;
            background: var(--red);
            color: var(--white);
            border: none;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .sub-card-btn:hover {
            background: var(--red-dark);
        }

        .sub-card-btn.current {
            background: transparent;
            border: 1px solid var(--cream);
            color: var(--cream);
            cursor: default;
        }

        /* Ticket List */
        .ticket-section {
            width: 100%;
            max-width: 500px;
            margin: 40px auto 0;
            text-align: center;
        }

        .ticket-section-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            color: var(--black);
            margin-bottom: 16px;
            letter-spacing: 2px;
        }

        .ticket-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .ticket-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 16px;
            background: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .ticket-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .ticket-item.used {
            opacity: 0.6;
            cursor: default;
        }

        .ticket-item.used:hover {
            transform: none;
        }

        .ticket-led {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .ticket-led.green {
            background: #22c55e;
            box-shadow: 0 0 8px #22c55e;
        }

        .ticket-led.red {
            background: #ef4444;
            box-shadow: 0 0 8px #ef4444;
        }

        .ticket-poster {
            width: 40px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .ticket-info {
            flex: 1;
        }

        .ticket-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            color: var(--black);
        }

        .ticket-date {
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.9rem;
            color: #666;
        }

        .ticket-code {
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            color: var(--red);
            font-weight: 500;
        }

        .ticket-empty {
            text-align: center;
            padding: 24px;
            color: #888;
            font-family: 'Cormorant Garamond', serif;
            font-style: italic;
        }

        /* QR Modal */
        .qr-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .qr-modal.active {
            display: flex;
        }

        .qr-content {
            background: var(--cream);
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            max-width: 350px;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            background: var(--white);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--black);
        }

        .qr-code img {
            width: 180px;
            height: 180px;
        }

        .qr-short-code {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            color: var(--black);
            letter-spacing: 4px;
            margin-bottom: 8px;
        }

        .qr-instructions {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 20px;
        }

        .qr-close {
            background: var(--black);
            color: var(--white);
            border: none;
            padding: 12px 32px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            cursor: pointer;
        }

        /* Membership Modal */
        .membership-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .membership-modal.active {
            display: flex;
        }

        .membership-content {
            background: var(--cream);
            padding: 40px;
            border-radius: 16px;
            max-width: 400px;
            width: 90%;
            position: relative;
        }

        .membership-close {
            position: absolute;
            top: 16px;
            right: 20px;
            background: transparent;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--black);
        }

        .membership-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: var(--black);
            text-align: center;
            margin-bottom: 8px;
        }

        .membership-subtitle {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            color: #666;
            text-align: center;
            margin-bottom: 24px;
        }

        .payment-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }

        .payment-option {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            border: 2px solid #ddd;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .payment-option:hover {
            border-color: var(--red);
        }

        .payment-option.selected {
            border-color: var(--red);
            background: rgba(201, 88, 111, 0.1);
        }

        .payment-option-radio {
            width: 20px;
            height: 20px;
            border: 2px solid #999;
            border-radius: 50%;
            position: relative;
        }

        .payment-option.selected .payment-option-radio {
            border-color: var(--red);
        }

        .payment-option.selected .payment-option-radio::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 10px;
            height: 10px;
            background: var(--red);
            border-radius: 50%;
        }

        .payment-option-info {
            flex: 1;
        }

        .payment-option-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            color: var(--black);
        }

        .discount-badge {
            background: var(--green);
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 8px;
        }

        .payment-option-price {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            color: var(--red);
        }

        .payment-option-savings {
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.9rem;
            color: var(--green);
            font-style: italic;
        }

        .membership-pay-btn {
            width: 100%;
            padding: 16px;
            background: var(--red);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .membership-pay-btn:hover {
            background: var(--red-dark);
        }

        .membership-note {
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.9rem;
            color: #888;
            text-align: center;
            margin-top: 12px;
        }

        /* ==================== MOVIE MODAL ==================== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 24px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal {
            background: var(--cream);
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            position: relative;
            border: 3px solid var(--black);
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 40px;
            height: 40px;
            background: var(--black);
            color: var(--white);
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 10;
        }

        .modal-poster {
            padding: 24px;
            display: flex;
            flex-direction: column;
        }

        .modal-poster img {
            width: 100%;
            aspect-ratio: 2/3;
            object-fit: cover;
            border: 2px solid var(--black);
        }

        .modal-poster-info {
            margin-top: 16px;
        }

        .modal-poster-info .director {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1rem;
            color: #666;
        }

        .modal-poster-info .title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            letter-spacing: 1px;
            margin: 4px 0;
        }

        .modal-poster-info .meta {
            font-size: 0.85rem;
            color: #666;
        }

        .modal-share {
            display: flex;
            gap: 16px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px dashed #ccc;
        }

        .modal-share button {
            background: none;
            border: none;
            font-size: 0.85rem;
            color: #666;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .modal-content {
            padding: 24px;
            border-left: 1px dashed #ccc;
        }

        .modal-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .modal-tab {
            padding: 10px 20px;
            border: 2px solid var(--black);
            background: var(--white);
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-tab.active {
            background: var(--green);
        }

        /* Funciones tab */
        .funciones-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .funcion-day {
            text-align: center;
        }

        .funcion-day-label {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.85rem;
            margin-bottom: 4px;
        }

        .funcion-day-date {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 8px;
        }

        .funcion-time {
            background: var(--green);
            padding: 6px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.85rem;
            margin-bottom: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .funcion-time:hover {
            background: var(--green-light);
        }

        .funcion-time.selected {
            background: var(--black);
            color: var(--white);
        }

        .modal-location {
            margin-top: 24px;
            padding: 12px;
            background: var(--white);
            border: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .perfil-user-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .perfil-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--red);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 600;
            overflow: hidden;
            border: 4px solid white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .perfil-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .perfil-details {
            text-align: center;
        }

        .perfil-name {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .perfil-email {
            font-size: 0.9rem;
            color: #666;
        }

        .logout-btn {
            background: none;
            border: 1px solid #ddd;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-top: 12px;
            color: #666;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: #f5f5f5;
            color: var(--black);
        }

        .modal-location-name {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-location-name::before {
            content: '■';
            color: var(--black);
        }

        .modal-reserve-btn {
            background: var(--red);
            color: var(--white);
            border: none;
            padding: 20px 32px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 1px;
            cursor: pointer;
            margin-top: 24px;
            margin-bottom: 24px;
            width: 100%;
            transition: background 0.2s;
        }

        .modal-reserve-btn:hover {
            background: var(--red-dark);
        }

        /* Magazine specific styles */
        .revista-grid {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 32px;
            margin-bottom: 60px;
        }

        .revista-card-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 234px;
            /* 30% larger than 180px */
        }

        .revista-card {
            width: 100%;
            height: 338px;
            /* 30% larger than 260px */
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s;
        }

        .revista-card:hover {
            transform: translateY(-4px);
        }

        .revista-price-tag {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            margin-top: 12px;
            color: var(--black);
        }

        .revista-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-top: 8px;
            background: white;
            padding: 4px 12px;
            border-radius: 20px;
            border: 1px solid #ddd;
        }

        .revista-btn {
            background: var(--black);
            color: var(--white);
            border: none;
            width: 28px;
            height: 28px;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s;
        }

        .revista-btn:active {
            transform: scale(0.9);
        }

        .revista-qty {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            width: 20px;
            text-align: center;
        }

        /* Checkout Summary in Modal */
        .checkout-summary {
            background: #f9f9f9;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
            border: 1px dashed #ccc;
        }

        .checkout-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .checkout-total {
            border-top: 1px solid #ddd;
            margin-top: 12px;
            padding-top: 12px;
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
        }

        .magazine-cart-float {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--black);
            color: white;
            padding: 20px 40px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 20px;
            z-index: 900;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            cursor: pointer;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .magazine-cart-float.active {
            transform: translateX(-50%) translateY(0);
        }


        .quantity-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            padding: 15px;
            background: #f5f0eb;
            border-radius: 8px;
        }

        .qty-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--black);
            background: transparent;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .qty-btn:hover {
            background: var(--black);
            color: var(--white);
        }

        #qtyValue {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            min-width: 30px;
            text-align: center;
        }

        .total-price {
            text-align: center;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }


        /* Sinopsis tab */
        .sinopsis-content {
            display: none;
            padding: 10px 0 20px 0;
        }

        .sinopsis-content.active {
            display: block;
        }

        .sinopsis-content p {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.15rem;
            line-height: 1.8;
            color: #333;
            margin-bottom: 24px;
        }

        /* ==================== SOCIAL SHARE STORY TEMPLATE ==================== */
        #storyTemplate {
            position: fixed;
            top: 0;
            left: 0;
            width: 1080px;
            height: 1920px;
            background: var(--cream);
            z-index: -1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px;
            box-sizing: border-box;
            background-image: radial-gradient(#d3cbbd 1px, transparent 1px);
            background-size: 40px 40px;
        }

        .story-logo {
            margin-bottom: 80px;
        }

        .story-logo img {
            height: 120px;
            width: auto;
        }

        .story-poster {
            width: 800px;
            height: 1200px;
            object-fit: cover;
            border: 8px solid var(--black);
            box-shadow: 40px 40px 0 rgba(0, 0, 0, 0.1);
            margin-bottom: 60px;
        }

        .story-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 6rem;
            text-align: center;
            margin-bottom: 20px;
            line-height: 1;
        }

        .story-meta {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.5rem;
            font-style: italic;
            color: #666;
        }

        .story-footer {
            margin-top: auto;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: var(--red);
            letter-spacing: 4px;
        }

        /* ==================== MOBILE STYLES ==================== */
        @media (max-width: 768px) {

            /* Mobile: Sections are horizontal */
            .sections-wrapper {
                display: flex;
                flex-direction: row;
                overflow-x: auto;
                overflow-y: hidden;
                scroll-snap-type: x mandatory;
                width: 100%;
                -webkit-overflow-scrolling: touch;
            }

            .section {
                width: 100%;
                min-width: 100vw;
                min-height: 100vh;
                min-height: 100dvh;
                scroll-snap-align: start;
                overflow-x: hidden;
                position: relative;
            }

            .logo-center img {
                height: 51px;
                /* Reduced by 15% (was 60px) */
            }

            /* Mobile bottom nav for sections */
            .mobile-section-nav {
                display: flex;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: var(--black);
                z-index: 100;
                padding: 12px 0 max(12px, env(safe-area-inset-bottom));
            }

            .mobile-section-nav a {
                flex: 1;
                text-align: center;
                color: #888;
                text-decoration: none;
                font-family: 'Bebas Neue', sans-serif;
                font-size: 0.7rem;
                letter-spacing: 0.5px;
                padding: 8px;
            }

            .mobile-section-nav a.active {
                color: var(--red);
            }

            /* Cartelera mobile adjustments */
            #cartelera {
                padding-bottom: 80px;
            }

            /* Movies: VERTICAL scroll on MOBILE */
            .movies-timeline {
                flex-direction: column;
                overflow-x: hidden;
                overflow-y: auto;
                scroll-snap-type: none;
                /* Disable scroll snap for smoother vertical scroll on mobile */
                padding: 100px 16px 120px;
                gap: 24px;
                align-items: center;
                width: 100%;
            }

            .day-separator {
                flex-direction: row;
                padding: 16px 0;
                min-width: unset;
                justify-content: flex-start;
                gap: 12px;
                scroll-snap-align: start;
            }

            .day-separator-date {
                font-size: 2rem;
            }

            .day-separator-weekday {
                margin-top: 0;
            }

            .movie-card {
                width: 100%;
                scroll-snap-align: start;
            }

            .movie-card:hover {
                transform: none;
                box-shadow: none;
            }

            .movie-poster {
                height: 210px;
            }

            .day-indicator {
                top: 70px;
                left: 16px;
                padding: 8px 14px;
                font-size: 0.9rem;
            }

            /* Modal mobile */
            .modal {
                grid-template-columns: 1fr;
                max-height: 100vh;
                height: 100%;
                border: none;
            }

            .modal-poster {
                padding: 16px;
            }

            .modal-poster img {
                max-height: 300px;
                width: auto;
                margin: 0 auto;
            }

            .modal-content {
                border-left: none;
                border-top: 1px dashed #ccc;
            }

            .funciones-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .section-title {
                font-size: 2.5rem;
            }

            #nosotros .section-title {
                font-size: 3rem;
            }

            /* Revista mobile improvements */
            #revista {
                padding: 100px 16px 120px;
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
                width: 100%;
                overflow-x: hidden;
            }

            #revista .section-title {
                font-size: 2rem;
                width: 100%;
            }

            #revista .section-subtitle {
                font-size: 1.1rem;
                text-align: center;
                padding: 0 16px;
                margin-bottom: 20px;
                width: 100%;
                max-width: 400px;
            }

            /* Nosotros mobile */
            #nosotros {
                padding: 100px 24px 120px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                text-align: center;
            }

            #nosotros p {
                font-size: 1.1rem;
                width: 100%;
                max-width: 100%;
                margin-left: auto;
                margin-right: auto;
            }

            /* Perfil mobile */
            #perfil {
                padding: 100px 16px 120px;
                overflow-y: auto;
                justify-content: flex-start;
                /* Ensure top of content is visible */
            }

            .profile-user-info {
                flex-direction: column;
                text-align: center;
            }

            .subscription-cards {
                flex-direction: column;
                align-items: center;
                gap: 16px;
            }

            .sub-card {
                width: 100%;
                max-width: 280px;
            }

            .ticket-section {
                margin-top: 32px;
                max-width: 100%;
            }

            .ticket-item {
                padding: 10px 12px;
                gap: 12px;
            }

            .ticket-poster {
                width: 35px;
                height: 52px;
            }

            .ticket-title {
                font-size: 1rem;
            }

            .ticket-code {
                font-size: 0.7rem;
            }

            .qr-content {
                padding: 30px 24px;
                margin: 16px;
            }

            .qr-short-code {
                font-size: 2rem;
            }

            .pdf-container {
                width: 95%;
                height: 70vh;
            }

            .pdf-paywall {
                padding: 24px 16px;
            }

            .pdf-paywall h3 {
                font-size: 1.5rem;
            }

            .pdf-paywall p {
                font-size: 1rem;
            }
        }

        @media (min-width: 769px) {
            .mobile-section-nav {
                display: none;
            }
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <!-- Day indicator now part of the header for perfect alignment -->
            <div class="day-indicator" id="dayIndicator">HOY</div>

            <a href="#cartelera" class="logo-center">
                <img src="logo-amorina.png" alt="Amorina">
            </a>

            <div class="header-icon" id="userProfileBtn">
                <div id="userAvatar"
                    style="display: none; width: 100%; height: 100%; border-radius: 50%; overflow: hidden; background: var(--red); color: white; align-items: center; justify-content: center; font-weight: 600; font-size: 0.9rem;">
                </div>
                <svg id="defaultUserIcon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <circle cx="12" cy="8" r="4" />
                    <path d="M4 20c0-4 4-6 8-6s8 2 8 6" />
                </svg>
            </div>
        </header>

        <!-- Navigation dots (desktop) -->
        <nav class="nav-dots">
            <div class="nav-dot active" onclick="goToSection(0)" title="Cartelera"></div>
            <div class="nav-dot" onclick="goToSection(1)" title="Revista"></div>
            <div class="nav-dot" onclick="goToSection(2)" title="Nosotros"></div>
            <div class="nav-dot" onclick="goToSection(3)" title="Mi Perfil"></div>
        </nav>

        <!-- Mobile bottom nav -->
        <nav class="mobile-section-nav">
            <a href="#" class="active" onclick="goToSection(0); return false;">CARTELERA</a>
            <a href="#" onclick="goToSection(1); return false;">REVISTA</a>
            <a href="#" onclick="goToSection(2); return false;">NOSOTROS</a>
            <a href="#" onclick="goToSection(3); return false;">PERFIL</a>
        </nav>

        <!-- Sections wrapper -->
        <div class="sections-wrapper" id="sectionsWrapper">
            <!-- CARTELERA SECTION -->
            <section id="cartelera" class="section">
                <div class="movies-timeline" id="moviesTimeline"></div>
            </section>

            <!-- REVISTA SECTION -->
            <section id="revista" class="section">
                <h2 class="section-title">REVISTA TITA!</h2>
                <p class="section-subtitle">Explorá nuestra revista digital con artículos sobre cine, cultura y más.</p>

                <div class="revista-grid">
                    <!-- Tita #1 -->
                    <div class="revista-card-wrapper">
                        <div class="revista-card" onclick="openRevista(1)">
                            <img src="revistas/tita-1.jpg" alt="Tita! #1"
                                style="width:100%; height:100%; object-fit:cover;">
                            <div class="revista-label">NÚMERO 1 · OCT '24</div>
                        </div>
                        <div class="revista-price-tag">$10.000</div>
                        <div class="revista-controls">
                            <button class="revista-btn" onclick="updateMagazineQty(1, -1)">-</button>
                            <span class="revista-qty" id="mag-qty-1">0</span>
                            <button class="revista-btn" onclick="updateMagazineQty(1, 1)">+</button>
                        </div>
                    </div>
                    <!-- Tita #2 -->
                    <div class="revista-card-wrapper">
                        <div class="revista-card" onclick="openRevista(2)">
                            <img src="revistas/tita-2.jpg" alt="Tita! #2"
                                style="width:100%; height:100%; object-fit:cover;">
                            <div class="revista-label">NÚMERO 2 · DIC '24</div>
                        </div>
                        <div class="revista-price-tag">$10.000</div>
                        <div class="revista-controls">
                            <button class="revista-btn" onclick="updateMagazineQty(2, -1)">-</button>
                            <span class="revista-qty" id="mag-qty-2">0</span>
                            <button class="revista-btn" onclick="updateMagazineQty(2, 1)">+</button>
                        </div>
                    </div>
                    <!-- Tita #3 -->
                    <div class="revista-card-wrapper">
                        <div class="revista-card" onclick="openRevista(3)">
                            <img src="revistas/tita-3.jpg" alt="Tita! #3"
                                style="width:100%; height:100%; object-fit:cover;">
                            <div class="revista-label">NÚMERO 3 · MAR '25</div>
                        </div>
                        <div class="revista-price-tag">$10.000</div>
                        <div class="revista-controls">
                            <button class="revista-btn" onclick="updateMagazineQty(3, -1)">-</button>
                            <span class="revista-qty" id="mag-qty-3">0</span>
                            <button class="revista-btn" onclick="updateMagazineQty(3, 1)">+</button>
                        </div>
                    </div>
                    <!-- Tita #4 -->
                    <div class="revista-card-wrapper">
                        <div class="revista-card" onclick="openRevista(4)">
                            <img src="revistas/tita-4.jpg" alt="Tita! #4"
                                style="width:100%; height:100%; object-fit:cover;">
                            <div class="revista-label">NÚMERO 4 · DIC '25</div>
                        </div>
                        <div class="revista-price-tag">$10.000</div>
                        <div class="revista-controls">
                            <button class="revista-btn" onclick="updateMagazineQty(4, -1)">-</button>
                            <span class="revista-qty" id="mag-qty-4">0</span>
                            <button class="revista-btn" onclick="updateMagazineQty(4, 1)">+</button>
                        </div>
                    </div>
                </div>

                <div id="magazineCartFloat" class="magazine-cart-float" onclick="openShippingModal()">
                    <span>PEDILA EN FISICO! (<span id="magCartCount">0</span>)</span>
                    <span id="magCartTotal">$0</span>
                </div>
            </section>

            <!-- Shipping Modal with Summary -->
            <div id="shippingModal" class="shipping-modal">
                <div class="shipping-content">
                    <span class="shipping-close" onclick="closeShippingModal()">&times;</span>

                    <h2 class="shipping-title">Resumen de Compra</h2>

                    <!-- Dynamic Summary -->
                    <div id="checkoutSummary" class="checkout-summary">
                        <!-- Items injected by JS -->
                        <div class="checkout-total">
                            <span>Total</span>
                            <span id="checkoutTotalValue">$0</span>
                        </div>
                    </div>

                    <h2 class="shipping-title" style="margin-top:24px;">¿Cómo querés recibirla?</h2>

                    <div class="shipping-option selected" onclick="selectShipping('pickup')">
                        <div class="shipping-chk"></div>
                        <span>Retirar por Amorina (Sin cargo)</span>
                    </div>

                    <div class="shipping-option" onclick="selectShipping('delivery')">
                        <div class="shipping-chk"></div>
                        <span>Envío a domicilio</span>
                    </div>

                    <div id="shippingFields" class="shipping-fields">
                        <div class="shipping-input-group">
                            <label>Dirección Completa</label>
                            <input type="text" id="shipAddress" placeholder="Calle 123, Piso, Depto">
                        </div>
                        <div class="shipping-input-group">
                            <label>Código Postal</label>
                            <input type="text" id="shipZip" placeholder="C1234" oninput="updateShippingQuote()">
                        </div>
                        <div id="shippingQuote" class="shipping-quote">
                            Costo de envío sugerido: <span class="shipping-total">$0</span>
                        </div>
                    </div>

                    <button class="shipping-btn" onclick="redirectToMagazinePayment()">CONTINUAR AL PAGO</button>
                </div>
            </div>

            <!-- PDF Reader Modal -->
            <div id="pdfModal" class="pdf-modal">
                <span class="pdf-close" onclick="closePdfModal()">&times;</span>
                <div class="pdf-container" id="pdfContainer">
                    <!-- PDF viewer or paywall will be inserted here -->
                </div>
            </div>

            <!-- NOSOTROS SECTION -->
            <section id="nosotros" class="section">
                <h2 class="section-title">NOSOTROS</h2>
                <p class="section-subtitle">Un espacio para el cine independiente y de autor.</p>
                <p>Amorina Cine Bar nace de la pasión por el séptimo arte. Un lugar donde el cine se vive, se debate y
                    se celebra. Ubicados en el corazón de Palermo, ofrecemos una experiencia cinematográfica única con
                    proyecciones cuidadosamente curadas, acompañadas de nuestra carta de tragos y comidas.</p>
            </section>

            <!-- PERFIL SECTION -->
            <section id="perfil" class="section">
                <h2 class="section-title">MI PERFIL</h2>

                <div id="loggedOutView"
                    style="display: flex; flex-direction: column; align-items: center; text-align: center; width: 100%;">
                    <p class="section-subtitle">Accedé a tu historial de películas y nivel de suscripción.</p>

                    <div class="subscription-cards">
                        <div class="sub-card">
                            <div class="sub-card-title">TU NIVEL</div>
                            <div class="sub-card-price free">GRATIS</div>
                            <ul class="sub-card-benefits">
                                <li>Acceso a la cartelera</li>
                                <li>Compra de entradas online</li>
                                <li>Historial de películas</li>
                            </ul>
                            <button class="sub-card-btn current">NIVEL ACTUAL</button>
                        </div>
                        <div class="sub-card">
                            <div class="sub-card-title">SOCIO AQUILEA</div>
                            <div class="sub-card-price">$20.000/mes</div>
                            <ul class="sub-card-benefits">
                                <li>10% descuento en entradas</li>
                                <li>Acceso anticipado</li>
                                <li>Newsletter exclusivo</li>
                                <li>50% revista Tita!</li>
                            </ul>
                            <button class="sub-card-btn" onclick="openMembershipModal('aquilea')">ASOCIARSE</button>
                        </div>
                        <div class="sub-card">
                            <div class="sub-card-title">SOCIO HONORÍFICO</div>
                            <div class="sub-card-price">$100.000/mes</div>
                            <ul class="sub-card-benefits">
                                <li>80% descuento en entradas</li>
                                <li>1 entrada gratis por mes</li>
                                <li>Eventos privados</li>
                                <li>Revista Tita! completa</li>
                            </ul>
                            <button class="sub-card-btn" onclick="openMembershipModal('honorifico')">ASOCIARSE</button>
                        </div>
                    </div>

                    <button class="login-btn" onclick="loginWithGoogle()"
                        style="margin-top: 40px; margin-left: auto; margin-right: auto;">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                            <path
                                d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                            <path
                                d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
                            <path
                                d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                        </svg>
                        INICIAR CON GOOGLE
                    </button>
                </div>

                <div id="loggedInView" style="display: none;">
                    <div class="perfil-user-info">
                        <div class="perfil-avatar" id="perfilAvatarContainer"></div>
                        <div class="perfil-details">
                            <div class="perfil-name" id="perfilName"></div>
                            <div class="perfil-email" id="perfilEmail"></div>
                            <button class="logout-btn" onclick="logout()">Cerrar Sesión</button>
                        </div>
                    </div>

                    <div class="subscription-cards">
                        <div class="sub-card">
                            <div class="sub-card-title">TU NIVEL</div>
                            <div class="sub-card-price free">GRATIS</div>
                            <ul class="sub-card-benefits">
                                <li>Acceso a la cartelera</li>
                                <li>Compra de entradas online</li>
                                <li>Historial de películas</li>
                            </ul>
                            <button class="sub-card-btn current">NIVEL ACTUAL</button>
                        </div>
                        <div class="sub-card">
                            <div class="sub-card-title">SOCIO AQUILEA</div>
                            <div class="sub-card-price">$20.000/mes</div>
                            <ul class="sub-card-benefits">
                                <li>10% descuento en entradas</li>
                                <li>Acceso anticipado</li>
                                <li>Newsletter exclusivo</li>
                                <li>50% revista Tita!</li>
                            </ul>
                            <button class="sub-card-btn" onclick="openMembershipModal('aquilea')">ASOCIARSE</button>
                        </div>
                        <div class="sub-card">
                            <div class="sub-card-title">SOCIO HONORÍFICO</div>
                            <div class="sub-card-price">$100.000/mes</div>
                            <ul class="sub-card-benefits">
                                <li>80% descuento en entradas</li>
                                <li>1 entrada gratis por mes</li>
                                <li>Eventos privados</li>
                                <li>Revista Tita! completa</li>
                            </ul>
                            <button class="sub-card-btn" onclick="openMembershipModal('honorifico')">ASOCIARSE</button>
                        </div>
                    </div>

                    <div class="ticket-section">
                        <div class="ticket-section-title">MIS ENTRADAS</div>
                        <div class="ticket-list" id="ticketList">
                            <!-- Tickets will be loaded here -->
                            <div class="ticket-empty">Cargando entradas...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- QR Modal -->
            <div class="qr-modal" id="qrModal">
                <div class="qr-content">
                    <div class="qr-code" id="qrCodeContainer">
                        <!-- QR code will be generated here -->
                    </div>
                    <div class="qr-short-code" id="qrShortCode">AMO-XXXX</div>
                    <div class="qr-instructions">Mostrá este código en la puerta del cine</div>
                    <button class="qr-close" onclick="closeQrModal()">CERRAR</button>
                </div>
            </div>

            <!-- Membership Modal -->
            <div class="membership-modal" id="membershipModal">
                <div class="membership-content">
                    <button class="membership-close" onclick="closeMembershipModal()">×</button>
                    <h2 class="membership-title" id="membershipTitle">ASOCIATE</h2>
                    <p class="membership-subtitle" id="membershipSubtitle">Elegí tu plan de pago</p>

                    <div class="payment-options">
                        <div class="payment-option" onclick="selectPaymentOption('monthly')">
                            <div class="payment-option-radio" id="radioMonthly"></div>
                            <div class="payment-option-info">
                                <div class="payment-option-title">MENSUAL</div>
                                <div class="payment-option-price" id="monthlyPrice">$20.000/mes</div>
                            </div>
                        </div>
                        <div class="payment-option selected" onclick="selectPaymentOption('annual')">
                            <div class="payment-option-radio" id="radioAnnual"></div>
                            <div class="payment-option-info">
                                <div class="payment-option-title">ANUAL <span class="discount-badge">20% OFF</span>
                                </div>
                                <div class="payment-option-price" id="annualPrice">$192.000/año</div>
                                <div class="payment-option-savings" id="annualSavings">Ahorrás $48.000</div>
                            </div>
                        </div>
                    </div>

                    <button class="membership-pay-btn" onclick="processMembershipPayment()">
                        PAGAR CON MERCADOPAGO
                    </button>
                    <p class="membership-note">Podés cancelar en cualquier momento</p>
                </div>
            </div>
        </div>
    </div>

    <!-- MOVIE MODAL -->
    <div class="modal-overlay" id="movieModal">
        <div class="modal">
            <button class="modal-close" onclick="closeModal()">×</button>
            <div class="modal-poster">
                <img id="modalPoster" src="" alt="">
                <div class="modal-poster-info">
                    <div class="director" id="modalDirector"></div>
                    <div class="title" id="modalTitle"></div>
                    <div class="meta" id="modalGenre"></div>
                    <div class="meta" id="modalMeta"></div>
                </div>
                <div class="modal-share">
                    <button onclick="shareStory()">📸 Compartir Story</button>
                    <button onclick="copyLink()">📋 Copiar Link</button>
                </div>
            </div>
            <div class="modal-content">
                <div class="modal-tabs">
                    <button class="modal-tab active" onclick="switchModalTab('funciones')">FUNCIONES</button>
                    <button class="modal-tab" onclick="switchModalTab('sinopsis')">SINOPSIS</button>
                </div>
                <div id="funcionesTab">
                    <div class="funciones-grid" id="funcionesGrid"></div>
                    <div class="modal-location">
                        <span class="modal-location-name">Amorina (caba)</span>
                        <a href="https://www.google.com/maps/search/Gorriti+5745" target="_blank">↗</a>
                    </div>

                    <div class="quantity-selector">
                        <button class="qty-btn" onclick="updateQty(-1)">-</button>
                        <span id="qtyValue">1</span>
                        <button class="qty-btn" onclick="updateQty(1)">+</button>
                    </div>
                    <div class="total-price" id="totalPriceDisplay">Total: $5000</div>

                    <button class="modal-reserve-btn" onclick="openReservation()">RESERVAR ENTRADA</button>
                </div>
                <div id="sinopsisTab" class="sinopsis-content">
                    <p id="modalSinopsis"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden Story Template -->
    <div id="storyTemplate">
        <div class="story-logo">
            <img src="logo-amorina.png" alt="Amorina">
        </div>
        <img id="storyPoster" class="story-poster" src="" alt="">
        <h1 id="storyTitle" class="story-title">TITULO</h1>
        <div id="storyMeta" class="story-meta">Director | Año</div>
        <div class="story-footer">AMORINA.CLUB</div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://iazjntvrxfyxlinkuiwx.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhempudHZyeGZ5eGxpbmt1aXd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2MjUwMDQsImV4cCI6MjA4MzIwMTAwNH0.otXE48RY5EWwjTXzDUvncLrJO7ujfU5RJTj6C--ouy4';

        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Auth Logic
        async function loginWithGoogle() {
            const { error } = await supabaseClient.auth.signInWithOAuth({
                provider: 'google',
                options: {
                    redirectTo: window.location.origin
                }
            });
            if (error) console.error('Error logging in:', error.message);
        }

        async function logout() {
            const { error } = await supabaseClient.auth.signOut();
            if (error) console.error('Error logging out:', error.message);
        }

        function updateAuthUI(user) {
            const loggedOutView = document.getElementById('loggedOutView');
            const loggedInView = document.getElementById('loggedInView');
            const userAvatar = document.getElementById('userAvatar');
            const defaultUserIcon = document.getElementById('defaultUserIcon');
            const perfilAvatarContainer = document.getElementById('perfilAvatarContainer');
            const perfilName = document.getElementById('perfilName');
            const perfilEmail = document.getElementById('perfilEmail');

            if (user) {
                loggedOutView.style.display = 'none';
                loggedInView.style.display = 'block';

                // Header Avatar
                userAvatar.style.display = 'flex';
                defaultUserIcon.style.display = 'none';

                const initials = user.user_metadata.full_name
                    ? user.user_metadata.full_name.split(' ').map(n => n[0]).join('').toUpperCase()
                    : user.email[0].toUpperCase();

                if (user.user_metadata.avatar_url) {
                    userAvatar.innerHTML = `<img src="${user.user_metadata.avatar_url}" alt="Avatar">`;
                    perfilAvatarContainer.innerHTML = `<img src="${user.user_metadata.avatar_url}" alt="Avatar">`;
                } else {
                    userAvatar.innerText = initials;
                    perfilAvatarContainer.innerText = initials;
                }

                // Perfil Section
                perfilName.innerText = user.user_metadata.full_name || 'Usuario';
                perfilEmail.innerText = user.email;
            } else {
                loggedOutView.style.display = 'block';
                loggedInView.style.display = 'none';
                userAvatar.style.display = 'none';
                defaultUserIcon.style.display = 'block';
            }
        }

        // Listen for auth changes
        supabaseClient.auth.onAuthStateChange((event, session) => {
            updateAuthUI(session?.user || null);
        });

        // Toggle perfil section from header
        document.getElementById('userProfileBtn').addEventListener('click', () => {
            goToSection(3); // Section index 3 is Perfil
        });

    </script>
    <script>
        // Schedule data
        let schedule = [];
        let currentMovie = null;
        let selectedFuncion = null;
        let isMobile = window.innerWidth <= 768;

        // Load schedule - Local JSON first (instant), Edge Function fallback
        async function loadSchedule() {
            try {
                // Try local schedule.json first (updated daily by GitHub Action)
                const localResponse = await fetch('schedule.json');
                if (!localResponse.ok) throw new Error('Local schedule not found');

                const data = await localResponse.json();
                if (!Array.isArray(data) || data.length === 0) {
                    throw new Error('Empty local schedule');
                }

                schedule = data;
                schedule.sort((a, b) => new Date(a.showtime) - new Date(b.showtime));

                renderTimeline();
                setupScrollObserver();
                console.log('✅ Loaded schedule from local JSON');

            } catch (localErr) {
                console.warn('Local schedule unavailable, fetching from Google Sheets...', localErr);

                // Fallback to Edge Function (slower but real-time)
                try {
                    const response = await fetch(`${SUPABASE_URL}/functions/v1/get-schedule`, {
                        headers: {
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'apikey': SUPABASE_ANON_KEY
                        }
                    });

                    if (!response.ok) throw new Error('Failed to fetch dynamic schedule');

                    const data = await response.json();

                    if (!Array.isArray(data) || data.length === 0) {
                        throw new Error('Empty dynamic schedule');
                    }

                    schedule = data;
                    schedule.sort((a, b) => new Date(a.showtime) - new Date(b.showtime));

                    renderTimeline();
                    setupScrollObserver();
                    console.log('✅ Loaded schedule from Edge Function');

                } catch (dynamicErr) {
                    console.error('❌ Both schedule sources failed:', dynamicErr);
                }
            }
        }

        // Format date
        function formatDate(dateStr) {
            // If dateStr is just a date (YYYY-MM-DD), add noon time to avoid timezone issues
            // new Date("2026-02-21") is interpreted as midnight UTC, which in Argentina (UTC-3) becomes Feb 20
            let date;
            if (dateStr.includes('T')) {
                date = new Date(dateStr);
            } else {
                // Add T12:00:00 to ensure it stays on the correct day in any timezone
                date = new Date(dateStr + 'T12:00:00');
            }
            const months = ['ENERO', 'FEBRERO', 'MARZO', 'ABRIL', 'MAYO', 'JUNIO',
                'JULIO', 'AGOSTO', 'SEPTIEMBRE', 'OCTUBRE', 'NOVIEMBRE', 'DICIEMBRE'];
            const days = ['DOMINGO', 'LUNES', 'MARTES', 'MIÉRCOLES', 'JUEVES', 'VIERNES', 'SÁBADO'];
            return {
                day: date.getDate(),
                month: months[date.getMonth()],
                weekday: days[date.getDay()]
            };
        }

        // Group movies by day (using local timezone)
        function groupByDay(movies) {
            const groups = {};
            movies.forEach(movie => {
                const date = new Date(movie.showtime);
                // Use local date components instead of toISOString() which converts to UTC
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const dayKey = `${year}-${month}-${day}`;
                if (!groups[dayKey]) {
                    groups[dayKey] = [];
                }
                groups[dayKey].push(movie);
            });
            return groups;
        }

        // Render infinite timeline
        function renderTimeline() {
            const container = document.getElementById('moviesTimeline');
            const grouped = groupByDay(schedule);
            const days = Object.keys(grouped).sort();

            let html = '';

            days.forEach((dayKey, dayIndex) => {
                const dateInfo = formatDate(dayKey);
                const movies = grouped[dayKey];

                // Add day separator
                html += `
                    <div class="day-separator" data-day="${dayKey}">
                        <div class="day-separator-date">${dateInfo.day}</div>
                        <div>
                            <div class="day-separator-month">${dateInfo.month}</div>
                            <div class="day-separator-weekday">${dateInfo.weekday}</div>
                        </div>
                    </div>
                `;

                // Add movies for this day
                movies.forEach(movie => {
                    const time = new Date(movie.showtime).toLocaleTimeString('es-AR', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    html += `
                        <div class="movie-card" data-day="${dayKey}" onclick="openModal('${movie.title}', '${movie.showtime}')">
                            <div class="movie-time-badge">${time}</div>
                            <img class="movie-poster" src="${movie.poster}" alt="${movie.title}" 
                                 loading="lazy" onerror="this.src='https://via.placeholder.com/300x450?text=No+Image'">
                            <div class="movie-info">
                                <div class="movie-director">${movie.director}</div>
                                <div class="movie-title">${movie.title}</div>
                                <div class="movie-meta">${movie.nationality || ''}</div>
                                <div class="movie-meta">${movie.runtime_mins ? movie.runtime_mins + "'" : ''} ${movie.year ? '/ ' + movie.year : ''}</div>
                                <div class="movie-footer">
                                    <span class="movie-price">$${movie.price}</span>
                                    <button class="movie-btn">SABER MÁS</button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            });

            container.innerHTML = html;
        }

        // Setup scroll observer to update day indicator
        function setupScrollObserver() {
            const timeline = document.getElementById('moviesTimeline');
            const indicator = document.getElementById('dayIndicator');

            timeline.addEventListener('scroll', () => {
                const separators = document.querySelectorAll('.day-separator');
                const cards = document.querySelectorAll('.movie-card');

                // Find current visible day
                let currentDay = null;

                if (isMobile) {
                    // Vertical scroll - check top position
                    const scrollTop = timeline.scrollTop;

                    [...separators, ...cards].forEach(el => {
                        if (el.offsetTop <= scrollTop + 150) {
                            currentDay = el.dataset.day;
                        }
                    });
                } else {
                    // Horizontal scroll - check left position
                    const scrollLeft = timeline.scrollLeft;

                    [...separators, ...cards].forEach(el => {
                        if (el.offsetLeft <= scrollLeft + 200) {
                            currentDay = el.dataset.day;
                        }
                    });
                }

                if (currentDay) {
                    const dateInfo = formatDate(currentDay);
                    indicator.textContent = `${dateInfo.weekday} ${dateInfo.day}`;
                    indicator.classList.remove('hidden');
                }
            });
        }

        // Section navigation
        function goToSection(index) {
            const wrapper = document.getElementById('sectionsWrapper');
            const sections = wrapper.querySelectorAll('.section');

            if (isMobile) {
                // Horizontal scroll on mobile
                wrapper.scrollTo({
                    left: sections[index].offsetLeft,
                    behavior: 'smooth'
                });
            } else {
                // Vertical scroll on desktop
                sections[index].scrollIntoView({ behavior: 'smooth' });
            }

            updateActiveNav(index);
        }

        // Update navigation state
        function updateActiveNav(index) {
            document.querySelectorAll('.nav-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });
            document.querySelectorAll('.mobile-section-nav a').forEach((link, i) => {
                link.classList.toggle('active', i === index);
            });

            // Update day indicator visibility
            const indicator = document.getElementById('dayIndicator');
            indicator.classList.toggle('hidden', index !== 0);
        }

        // Observe section changes
        function setupSectionObserver() {
            const wrapper = document.getElementById('sectionsWrapper');

            wrapper.addEventListener('scroll', () => {
                const sections = wrapper.querySelectorAll('.section');

                if (isMobile) {
                    // Horizontal scroll - check which section is visible
                    const scrollLeft = wrapper.scrollLeft;
                    const sectionWidth = window.innerWidth;
                    const currentIndex = Math.round(scrollLeft / sectionWidth);
                    updateActiveNav(currentIndex);
                } else {
                    // Vertical scroll
                    const scrollTop = wrapper.scrollTop;
                    sections.forEach((section, i) => {
                        if (section.offsetTop <= scrollTop + 200) {
                            updateActiveNav(i);
                        }
                    });
                }
            });
        }

        // Open modal
        function openModal(movieTitle, showtime) {
            // Reset quantity on open
            ticketQuantity = 1;
            document.getElementById('qtyValue').innerText = '1';

            currentMovie = schedule.find(m => m.title === movieTitle && m.showtime === showtime);
            if (!currentMovie) {
                currentMovie = schedule.find(m => m.title === movieTitle);
            }
            if (!currentMovie) return;

            const price = currentMovie.price || 5000;
            document.getElementById('totalPriceDisplay').innerText = `Total: $${price}`;

            // Find all showtimes for this movie
            const allShowtimes = schedule.filter(m => m.title === currentMovie.title);

            // Group by day
            const byDay = {};
            allShowtimes.forEach(s => {
                const date = new Date(s.showtime);
                const dayKey = date.toISOString().split('T')[0];
                if (!byDay[dayKey]) byDay[dayKey] = [];
                byDay[dayKey].push(s);
            });

            // Update modal content
            document.getElementById('modalPoster').src = currentMovie.poster;
            document.getElementById('modalDirector').textContent = currentMovie.director;
            document.getElementById('modalTitle').textContent = currentMovie.title;
            document.getElementById('modalGenre').textContent = currentMovie.genre;
            document.getElementById('modalMeta').textContent =
                `${currentMovie.nationality || ''} ${currentMovie.runtime_mins ? currentMovie.runtime_mins + "'" : ''} / ${currentMovie.year || ''}`;
            document.getElementById('modalSinopsis').textContent = currentMovie.overview || 'Sin sinopsis disponible.';

            // Get month name
            const months = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio',
                'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];

            // Render funciones
            const funcionesGrid = document.getElementById('funcionesGrid');
            funcionesGrid.innerHTML = Object.entries(byDay).slice(0, 4).map(([day, shows]) => {
                const date = new Date(day + 'T12:00:00');
                const dayName = ['DOM', 'LUN', 'MAR', 'MIÉ', 'JUE', 'VIE', 'SÁB'][date.getDay()];
                const monthName = months[date.getMonth()];
                return `
                    <div class="funcion-day">
                        <div class="funcion-day-label">${dayName} ${date.getDate()}</div>
                        <div class="funcion-day-date">${monthName}</div>
                        ${shows.map(s => {
                    const time = new Date(s.showtime).toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });
                    return `<div class="funcion-time" onclick="selectFuncion('${s.showtime}', event)">${time}</div>`;
                }).join('')}
                    </div>
                `;
            }).join('');

            // Show modal
            document.getElementById('movieModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Select funcion
        function selectFuncion(showtime, event) {
            event.stopPropagation();
            selectedFuncion = showtime;
            document.querySelectorAll('.funcion-time').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
        }

        // Close modal
        function closeModal() {
            document.getElementById('movieModal').classList.remove('active');
            document.body.style.overflow = '';
            currentMovie = null;
            selectedFuncion = null;
        }

        // Switch modal tab
        function switchModalTab(tab) {
            document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            document.getElementById('funcionesTab').style.display = tab === 'funciones' ? 'block' : 'none';
            document.getElementById('sinopsisTab').style.display = tab === 'sinopsis' ? 'block' : 'none';
            document.getElementById('sinopsisTab').classList.toggle('active', tab === 'sinopsis');
        }


        let ticketQuantity = 1;

        function updateQty(delta) {
            ticketQuantity = Math.max(1, Math.min(10, ticketQuantity + delta));
            document.getElementById('qtyValue').innerText = ticketQuantity;

            const basePrice = parseInt(currentMovie?.price) || 5000;
            const discount = getUserDiscount();
            const discountedPrice = Math.round(basePrice * (1 - discount / 100));
            const total = discountedPrice * ticketQuantity;

            if (discount > 0) {
                document.getElementById('totalPriceDisplay').innerHTML = `
                    <span style="text-decoration: line-through; color: #999;">$${(basePrice * ticketQuantity).toLocaleString('es-AR')}</span>
                    Total: $${total.toLocaleString('es-AR')} <span style="color: var(--green); font-size: 0.8em;">(${discount}% OFF)</span>
                `;
            } else {
                document.getElementById('totalPriceDisplay').innerText = `Total: $${total.toLocaleString('es-AR')}`;
            }
        }

        async function openReservation() {
            if (!selectedFuncion) {
                alert('Por favor, selecciona un horario primero.');
                return;
            }

            // Check if user is logged in
            const { data: { user } } = await supabaseClient.auth.getUser();

            if (!user) {
                alert('Debes iniciar sesión para reservar una entrada.');
                closeModal();
                goToSection(3); // Go to Profile/Login section
                return;
            }

            const reserveBtn = document.querySelector('.modal-reserve-btn');
            const originalText = reserveBtn.innerText;
            reserveBtn.innerText = 'PROCESANDO...';
            reserveBtn.disabled = true;

            // Calculate discounted price
            const basePrice = parseInt(currentMovie?.price) || 5000;
            const discount = getUserDiscount();
            const discountedPrice = Math.round(basePrice * (1 - discount / 100));
            const totalAmount = discountedPrice * ticketQuantity;

            try {
                // Check if admin - bypass MercadoPago
                if (isUserAdmin(user.email)) {
                    // Generate 6-character alphanumeric ticket code (compatible with staff app)
                    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
                    let ticketCode = '';
                    for (let i = 0; i < 6; i++) {
                        ticketCode += chars.charAt(Math.floor(Math.random() * chars.length));
                    }
                    const userName = user.user_metadata?.full_name || user.email.split('@')[0];

                    // Generate QR payload (same format as webhook)
                    const shortDate = selectedFuncion.substring(0, 13);
                    const qrPayload = `AMO|${ticketCode}|${currentMovie.title}|${shortDate}|${userName}|${user.email}`;

                    const { data: purchase, error } = await supabaseClient
                        .from('purchases')
                        .insert({
                            user_id: user.id,
                            user_email: user.email,
                            user_name: userName,
                            movie_title: currentMovie.title,
                            movie_poster: currentMovie.poster,
                            showtime: selectedFuncion,
                            quantity: ticketQuantity,
                            unit_price: discountedPrice,
                            total_amount: totalAmount,
                            discount_applied: discount,
                            ticket_code: ticketCode,
                            qr_payload: qrPayload,
                            status: 'active',
                            payment_status: 'admin_bypass'
                        })
                        .select()
                        .single();

                    if (error) throw error;

                    // Sync to Google Sheets (optional, won't block if it fails)
                    try {
                        const syncResponse = await fetch(`${SUPABASE_URL}/functions/v1/sync-reservation`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                            },
                            body: JSON.stringify({
                                ticket_code: ticketCode,
                                movie_title: currentMovie.title,
                                show_datetime: selectedFuncion,
                                user_name: userName,
                                user_email: user.email,
                                quantity: ticketQuantity,
                                total_amount: totalAmount,
                                qr_payload: qrPayload
                            })
                        });
                        const syncResult = await syncResponse.json();
                        console.log('Sync result:', syncResult);
                        if (!syncResult.success) {
                            console.error('Sheet sync error:', syncResult);
                        }
                    } catch (syncErr) {
                        console.warn('Sheet sync failed (non-blocking):', syncErr);
                    }

                    alert(`✅ Reserva creada con éxito!\n\nCódigo: ${ticketCode}\n(Admin bypass - sin pago)`);
                    closeModal();
                    loadUserTickets(); // Refresh ticket list
                    return;
                }

                // Normal flow - MercadoPago checkout
                const response = await fetch(`${SUPABASE_URL}/functions/v1/checkout`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    },
                    body: JSON.stringify({
                        showtime: {
                            title: currentMovie.title,
                            showtime: selectedFuncion,
                            price: discountedPrice.toString(),
                            poster: currentMovie.poster
                        },
                        quantity: ticketQuantity,
                        userEmail: user.email,
                        userName: user.user_metadata.full_name || user.email.split('@')[0],
                        discount_applied: discount,
                        user_id: user.id
                    })
                });

                const data = await response.json();

                if (data.initPoint) {
                    window.location.href = data.initPoint;
                } else {
                    console.error('Error result:', data);
                    alert('Error al iniciar el pago. ' + (data.error || 'Por favor intenta más tarde.'));
                    reserveBtn.innerText = originalText;
                    reserveBtn.disabled = false;
                }
            } catch (error) {
                console.error('Checkout error:', error);
                alert('Error de conexión. Intenta de nuevo.');
                reserveBtn.innerText = originalText;
                reserveBtn.disabled = false;
            }
        }

        async function shareStory() {
            if (!currentMovie) return;

            const btn = document.querySelector('.modal-share button');
            const originalText = btn.innerText;
            btn.innerText = 'Generando...';
            btn.disabled = true;

            // Populate template
            document.getElementById('storyPoster').src = currentMovie.poster;
            document.getElementById('storyTitle').textContent = currentMovie.title;
            document.getElementById('storyMeta').textContent = `${currentMovie.director} | ${currentMovie.year}`;

            // Wait for image to load
            await new Promise(resolve => {
                const img = document.getElementById('storyPoster');
                if (img.complete) resolve();
                else img.onload = resolve;
            });

            try {
                const canvas = await html2canvas(document.getElementById('storyTemplate'), {
                    scale: 1, // Full resolution
                    useCORS: true,
                    allowTaint: true
                });

                canvas.toBlob(async (blob) => {
                    const file = new File([blob], `amorina-story-${currentMovie.title}.png`, { type: 'image/png' });

                    if (navigator.share && navigator.canShare({ files: [file] })) {
                        try {
                            await navigator.share({
                                files: [file],
                                title: `Ver ${currentMovie.title} en Amorina`,
                                text: `¡Vamos a ver ${currentMovie.title} en Amorina! 🎬`
                            });
                        } catch (err) {
                            if (err.name !== 'AbortError') console.error('Error sharing:', err);
                        }
                    } else {
                        // Fallback: Download
                        const link = document.createElement('a');
                        link.download = `amorina-story-${currentMovie.title}.png`;
                        link.href = canvas.toDataURL();
                        link.click();
                        alert('Imagen descargada! Podés subirla a tu historia manualmtente.');
                    }

                    btn.innerText = originalText;
                    btn.disabled = false;
                });
            } catch (error) {
                console.error('Error generating story:', error);
                alert('Hubo un error al generar la imagen.');
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href);
            alert('Link copiado!');
        }

        // Revista PDF functions
        const revistaData = {
            1: { title: 'Tita! #1 - Octubre 2024', pdf: 'revistas/tita-1.pdf', totalPages: 20, freePages: 10 },
            2: { title: 'Tita! #2 - Diciembre 2024', pdf: 'revistas/tita-2.pdf', totalPages: 24, freePages: 12 },
            3: { title: 'Tita! #3 - Marzo 2025', pdf: 'revistas/tita-3.pdf', totalPages: 22, freePages: 11 },
            4: { title: 'Tita! #4 - Diciembre 2025', pdf: 'revistas/tita-4.pdf', totalPages: 26, freePages: 13 },
        };

        function openRevista(num) {
            const revista = revistaData[num];
            if (!revista) return;

            const modal = document.getElementById('pdfModal');
            const container = document.getElementById('pdfContainer');

            // Show full PDF (all pages free)
            container.innerHTML = `
                <iframe src="${revista.pdf}#toolbar=0&navpanes=0&scrollbar=0&view=FitH" title="${revista.title}" style="border:none; width:100%; height:100%;"></iframe>
            `;

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Magazine Shop Logic
        const magazineCart = { 1: 0, 2: 0, 3: 0, 4: 0 };
        const MAGAZINE_PRICE = 10000;

        function updateMagazineQty(id, delta) {
            const current = magazineCart[id] || 0;
            const newQty = Math.max(0, current + delta);
            magazineCart[id] = newQty;

            // Update UI
            document.getElementById(`mag-qty-${id}`).textContent = newQty;
            updateMagazineCartTotal();
        }

        function updateMagazineCartTotal() {
            let total = 0;
            let count = 0;

            Object.entries(magazineCart).forEach(([id, qty]) => {
                if (qty > 0) {
                    count += qty;
                    // Discount Logic: If 2 or more of THE SAME issue, 20% off applied to that line item
                    if (qty >= 2) {
                        total += (qty * MAGAZINE_PRICE) * 0.8; // 20% off
                    } else {
                        total += qty * MAGAZINE_PRICE;
                    }
                }
            });

            const floatBtn = document.getElementById('magazineCartFloat');
            const totalDisplay = document.getElementById('magCartTotal');
            const countDisplay = document.getElementById('magCartCount');

            if (count > 0) {
                floatBtn.classList.add('active');
                totalDisplay.textContent = `$${total.toLocaleString('es-AR')}`;
                if (countDisplay) countDisplay.textContent = count;
            } else {
                floatBtn.classList.remove('active');
            }
        }

        function openShippingModal() {
            // Populate Summary
            const summaryContainer = document.getElementById('checkoutSummary');
            let html = '';
            let total = 0;
            let itemCount = 0;

            Object.entries(magazineCart).forEach(([id, qty]) => {
                if (qty > 0) {
                    itemCount += qty;
                    let lineTotal = 0;
                    let discountTag = '';

                    if (qty >= 2) {
                        lineTotal = (qty * MAGAZINE_PRICE) * 0.8;
                        discountTag = ' <span style="color:var(--green); font-size:0.8rem; margin-left:8px;">(20% OFF)</span>';
                    } else {
                        lineTotal = qty * MAGAZINE_PRICE;
                    }

                    total += lineTotal;

                    // Format: "Tita! #4 x2 - $16.000" 
                    html += `
                        <div class="checkout-item">
                            <span>Tita! #${id} x${qty}${discountTag}</span>
                            <span>$${lineTotal.toLocaleString('es-AR')}</span>
                        </div>
                    `;
                }
            });

            // Add total row at the end
            html += `
                <div class="checkout-total">
                    <span>TOTAL (${itemCount} revista${itemCount > 1 ? 's' : ''})</span>
                    <span>$${total.toLocaleString('es-AR')}</span>
                </div>
            `;

            summaryContainer.innerHTML = html;

            const modal = document.getElementById('shippingModal');
            modal.classList.add('active');
        }

        function closePdfModal() {
            const modal = document.getElementById('pdfModal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        // ==================== TICKET SYSTEM ====================
        let userProfile = null;
        let userTickets = [];

        // Load user profile from database
        async function loadUserProfile() {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return null;

                const { data: profile, error } = await supabaseClient
                    .from('users')
                    .select('*')
                    .eq('id', user.id)
                    .single();

                if (error) {
                    console.log('Profile not found, will be created on next login');
                    return null;
                }

                userProfile = profile;

                // Update UI to show membership level
                updateMembershipUI(profile);

                return profile;
            } catch (err) {
                console.error('Error loading profile:', err);
                return null;
            }
        }

        // Update membership display in cards
        function updateMembershipUI(profile) {
            if (!profile) return;

            const cards = document.querySelectorAll('.sub-card');
            cards.forEach(card => {
                const title = card.querySelector('.sub-card-title')?.textContent?.toLowerCase();
                const btn = card.querySelector('.sub-card-btn');
                if (!btn) return;

                if (title?.includes('tu nivel') && profile.membership_level !== 'free') {
                    // User has a paid membership, hide the free card
                    card.style.opacity = '0.5';
                } else if (title?.includes('aquilea') && profile.membership_level === 'aquilea') {
                    btn.textContent = 'NIVEL ACTUAL';
                    btn.classList.add('current');
                    btn.onclick = null;
                } else if (title?.includes('honorífico') && profile.membership_level === 'honorifico') {
                    btn.textContent = 'NIVEL ACTUAL';
                    btn.classList.add('current');
                    btn.onclick = null;
                }
            });

            // Show admin badge if admin
            if (profile.is_admin) {
                const perfilName = document.getElementById('perfilName');
                if (perfilName && !perfilName.innerHTML.includes('ADMIN')) {
                    perfilName.innerHTML += ' <span style="background:var(--red);color:white;padding:2px 8px;font-size:0.7rem;border-radius:4px;">ADMIN</span>';
                }
            }
        }

        // Load user tickets from database
        async function loadUserTickets() {
            const ticketList = document.getElementById('ticketList');
            if (!ticketList) return;

            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) {
                    ticketList.innerHTML = '<div class="ticket-empty">Iniciá sesión para ver tus entradas.</div>';
                    return;
                }

                const { data: purchases, error } = await supabaseClient
                    .from('purchases')
                    .select('*')
                    .eq('user_id', user.id)
                    .order('showtime', { ascending: false });

                if (error) throw error;

                userTickets = purchases || [];

                if (userTickets.length === 0) {
                    ticketList.innerHTML = '<div class="ticket-empty">No tenés entradas compradas todavía.</div>';
                    return;
                }

                // Sort: available first, then by date
                const sortedTickets = [...userTickets].sort((a, b) => {
                    const aExpired = a.status !== 'active' || new Date(a.showtime) < new Date();
                    const bExpired = b.status !== 'active' || new Date(b.showtime) < new Date();
                    if (aExpired !== bExpired) return aExpired ? 1 : -1;
                    return new Date(b.showtime) - new Date(a.showtime);
                });

                ticketList.innerHTML = sortedTickets.map(ticket => {
                    const date = new Date(ticket.showtime);
                    const isExpired = ticket.status !== 'active' || date < new Date();
                    const dateStr = date.toLocaleDateString('es-AR', { weekday: 'short', day: 'numeric', month: 'short' });
                    const timeStr = date.toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });

                    return `
                        <div class="ticket-item ${isExpired ? 'used' : ''}" ${!isExpired ? `onclick="showTicketQR('${ticket.ticket_code}', '${ticket.movie_title}')"` : ''}>
                            <div class="ticket-led ${isExpired ? 'red' : 'green'}"></div>
                            <img class="ticket-poster" src="${ticket.movie_poster || ''}" alt="${ticket.movie_title}" onerror="this.src='https://via.placeholder.com/40x60?text=?'">
                            <div class="ticket-info">
                                <div class="ticket-title">${ticket.movie_title}</div>
                                <div class="ticket-date">${dateStr} - ${timeStr}</div>
                            </div>
                            <div class="ticket-code">${ticket.ticket_code}</div>
                        </div>
                    `;
                }).join('');

            } catch (err) {
                console.error('Error loading tickets:', err);
                ticketList.innerHTML = '<div class="ticket-empty">Error al cargar entradas.</div>';
            }
        }

        // Check if user is admin (can skip payment)
        // Hardcoded admin emails that can bypass payment
        const ADMIN_EMAILS = ['giannirolontoro@gmail.com'];

        function isUserAdmin(email = null) {
            // Check hardcoded admin emails first
            const emailToCheck = email || userProfile?.email;
            if (emailToCheck && ADMIN_EMAILS.includes(emailToCheck.toLowerCase())) {
                return true;
            }
            // Fallback to database is_admin flag
            return userProfile?.is_admin === true;
        }

        // Get user's discount percentage based on membership
        function getUserDiscount() {
            if (!userProfile) return 0;
            if (userProfile.membership_level === 'honorifico') return 80;
            if (userProfile.membership_level === 'aquilea') return 10;
            return 0;
        }

        function showTicketQR(code, title) {
            const modal = document.getElementById('qrModal');
            const codeDisplay = document.getElementById('qrShortCode');
            const qrContainer = document.getElementById('qrCodeContainer');

            codeDisplay.textContent = code;

            // Generate simple QR code using a public API
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(code + '|' + title)}`;
            qrContainer.innerHTML = `<img src="${qrUrl}" alt="QR Code">`;

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeQrModal() {
            const modal = document.getElementById('qrModal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        // ==================== MEMBERSHIP SYSTEM ====================
        const membershipPlans = {
            aquilea: {
                name: 'Socio Aquilea',
                monthlyPrice: 20000,
                annualPrice: 192000, // 20% off (240000 * 0.8)
                discount: 10 // % off ticket price
            },
            honorifico: {
                name: 'Socio Honorífico',
                monthlyPrice: 100000,
                annualPrice: 960000, // 20% off (1200000 * 0.8)
                discount: 80 // % off ticket price
            }
        };

        let currentMembershipPlan = null;
        let currentPaymentInterval = 'annual'; // 'monthly' or 'annual'

        function openMembershipModal(planType) {
            const plan = membershipPlans[planType];
            if (!plan) return;

            currentMembershipPlan = planType;

            const modal = document.getElementById('membershipModal');
            const title = document.getElementById('membershipTitle');
            const monthlyPrice = document.getElementById('monthlyPrice');
            const annualPrice = document.getElementById('annualPrice');
            const annualSavings = document.getElementById('annualSavings');

            title.textContent = `ASOCIATE: ${plan.name.toUpperCase()}`;
            monthlyPrice.textContent = `$${plan.monthlyPrice.toLocaleString('es-AR')}/mes`;
            annualPrice.textContent = `$${plan.annualPrice.toLocaleString('es-AR')}/año`;

            const yearlySavings = (plan.monthlyPrice * 12) - plan.annualPrice;
            annualSavings.textContent = `Ahorrás $${yearlySavings.toLocaleString('es-AR')}`;

            // Reset selection to annual
            selectPaymentOption('annual');

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeMembershipModal() {
            const modal = document.getElementById('membershipModal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
            currentMembershipPlan = null;
        }

        function selectPaymentOption(interval) {
            currentPaymentInterval = interval;

            const options = document.querySelectorAll('.payment-option');
            options.forEach(opt => opt.classList.remove('selected'));

            const selectedOption = interval === 'monthly' ? options[0] : options[1];
            selectedOption.classList.add('selected');
        }

        async function processMembershipPayment() {
            if (!currentMembershipPlan) return;

            const plan = membershipPlans[currentMembershipPlan];
            const isAnnual = currentPaymentInterval === 'annual';
            const amount = isAnnual ? plan.annualPrice : plan.monthlyPrice;
            const description = `${plan.name} - ${isAnnual ? 'Anual' : 'Mensual'}`;

            const btn = document.querySelector('.membership-pay-btn');
            btn.textContent = 'PROCESANDO...';
            btn.disabled = true;

            try {
                // Call the subscription Edge Function
                const response = await fetch(`${SUPABASE_URL}/functions/v1/create-subscription`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'apikey': SUPABASE_ANON_KEY
                    },
                    body: JSON.stringify({
                        plan_type: currentMembershipPlan,
                        interval: currentPaymentInterval,
                        amount: amount,
                        description: description,
                        user_email: document.getElementById('perfilEmail')?.textContent || '',
                        user_name: document.getElementById('perfilName')?.textContent || ''
                    })
                });

                const data = await response.json();

                if (data.init_point) {
                    // Redirect to MercadoPago
                    window.location.href = data.init_point;
                } else {
                    throw new Error(data.error || 'Error al crear la suscripción');
                }
            } catch (error) {
                console.error('Membership payment error:', error);
                alert('Error al procesar el pago. Intentá de nuevo.');
                btn.textContent = 'PAGAR CON MERCADOPAGO';
                btn.disabled = false;
            }
        }

        // Close membership modal on escape
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape' && document.getElementById('membershipModal').classList.contains('active')) {
                closeMembershipModal();
            }
        });

        // Load tickets when user logs in
        const originalUpdateUI = window.updateUI;
        window.updateUI = function (user) {
            if (typeof originalUpdateUI === 'function') {
                originalUpdateUI(user);
            }
            if (user) {
                // Load profile first, then tickets
                loadUserProfile().then(() => {
                    loadUserTickets();
                });
            }
        };

        // Also load on page load if already logged in
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(async () => {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (user) {
                    await loadUserProfile();
                    await loadUserTickets();
                }
            }, 500);
        });

        // Close PDF modal on escape
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape' && document.getElementById('pdfModal').classList.contains('active')) {
                closePdfModal();
            }
        });

        // Close modal on escape
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') closeModal();
        });

        // Shipping Modal Logic
        let shippingType = 'pickup';
        const BASE_MAGAZINE_PRICE = 15000; // Assuming a base price for the magazine

        function openShippingModal() {
            document.getElementById('shippingModal').classList.add('active');
        }

        function closeShippingModal() {
            document.getElementById('shippingModal').classList.remove('active');
        }

        function selectShipping(type) {
            shippingType = type;
            const options = document.querySelectorAll('.shipping-option');
            options[0].classList.toggle('selected', type === 'pickup');
            options[1].classList.toggle('selected', type === 'delivery');

            const fields = document.getElementById('shippingFields');
            fields.classList.toggle('active', type === 'delivery');

            updateShippingQuote();
        }

        function updateShippingQuote() {
            const quoteDiv = document.getElementById('shippingQuote');
            if (shippingType === 'pickup') {
                quoteDiv.classList.remove('active');
                return;
            }

            const zip = document.getElementById('shipZip').value.trim().toUpperCase();
            if (zip.length < 2) {
                quoteDiv.classList.remove('active');
                return;
            }

            // Estimate distance based on first digit of ZIP
            // Logic: Base 8000 + 1000 every 100km
            let distanceKm = 0;
            const digit = zip.match(/\d/);
            const firstDigit = digit ? parseInt(digit[0]) : 1;

            if (firstDigit === 1) distanceKm = 30; // CABA/GBA
            else if (firstDigit === 2) distanceKm = 300; // BA Interior
            else if (firstDigit === 3) distanceKm = 400; // Mesop/Litoral
            else if (firstDigit === 4) distanceKm = 700; // Cordoba/SL
            else if (firstDigit === 5) distanceKm = 1000; // Cuyo
            else if (firstDigit === 6 || firstDigit === 7) distanceKm = 1500; // NOA
            else distanceKm = 2000; // Patagonia

            const shippingCost = 8000 + (Math.floor(distanceKm / 100) * 1000);

            quoteDiv.querySelector('.shipping-total').textContent = `$${shippingCost.toLocaleString('es-AR')}`;
            quoteDiv.classList.add('active');
        }

        async function redirectToMagazinePayment() {
            if (shippingType === 'delivery') {
                const address = document.getElementById('shipAddress').value;
                const zip = document.getElementById('shipZip').value;
                if (!address || !zip) {
                    alert('Por favor completa los datos de envío');
                    return;
                }
            }

            // Get current user info
            const { data: { user } } = await supabaseClient.auth.getUser();
            if (!user) {
                alert('Necesitás iniciar sesión para continuar con la compra');
                goToSection(3); // Go to profile section
                closeShippingModal();
                return;
            }

            // Build order items
            const items = [];
            let subtotal = 0;
            let discountAmount = 0;

            Object.entries(magazineCart).forEach(([id, qty]) => {
                if (qty > 0) {
                    const unitPrice = MAGAZINE_PRICE;
                    let lineTotal = qty * unitPrice;
                    let hasDiscount = false;

                    if (qty >= 2) {
                        const originalTotal = lineTotal;
                        lineTotal = lineTotal * 0.8; // 20% off
                        discountAmount += (originalTotal - lineTotal);
                        hasDiscount = true;
                    }

                    subtotal += lineTotal;

                    items.push({
                        id: parseInt(id),
                        quantity: qty,
                        title: `Tita! #${id}`,
                        unitPrice: unitPrice,
                        lineTotal: lineTotal,
                        hasDiscount: hasDiscount
                    });
                }
            });

            // Calculate shipping
            const shippingCost = shippingType === 'delivery' ? 8000 : 0;
            const totalAmount = subtotal + shippingCost;

            // Show loading state
            const payBtn = document.querySelector('.shipping-btn');
            const originalText = payBtn.textContent;
            payBtn.textContent = 'Procesando...';
            payBtn.disabled = true;

            try {
                const response = await fetch(`${SUPABASE_URL}/functions/v1/magazine-checkout`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'apikey': SUPABASE_ANON_KEY
                    },
                    body: JSON.stringify({
                        items: items,
                        subtotal: subtotal,
                        discountAmount: discountAmount,
                        shippingMethod: shippingType,
                        shippingCost: shippingCost,
                        shippingAddress: shippingType === 'delivery' ? {
                            address: document.getElementById('shipAddress').value,
                            postalCode: document.getElementById('shipZip').value
                        } : null,
                        userEmail: user.email,
                        userName: user.user_metadata.full_name || user.email.split('@')[0],
                        totalAmount: totalAmount
                    })
                });

                const data = await response.json();

                if (data.success && data.initPoint) {
                    // Redirect to MercadoPago
                    window.location.href = data.initPoint;
                } else {
                    console.error('Checkout error:', data);
                    alert('Error al crear el pago. Por favor intentá de nuevo.');
                }
            } catch (error) {
                console.error('Payment error:', error);
                alert('Error de conexión. Verificá tu conexión a internet.');
            } finally {
                payBtn.textContent = originalText;
                payBtn.disabled = false;
            }
        }

        // Close modal on overlay click
        document.getElementById('movieModal').addEventListener('click', e => {
            if (e.target.classList.contains('modal-overlay')) closeModal();
        });

        // Init
        loadSchedule();
        setupSectionObserver();

        // Date Indicator Fade Logic
        const sectionsWrapper = document.querySelector('.sections-wrapper');
        const dayIndicator = document.getElementById('dayIndicator');

        sectionsWrapper.addEventListener('scroll', () => {
            const scrollTop = sectionsWrapper.scrollTop;
            const scrollLeft = sectionsWrapper.scrollLeft;
            const windowHeight = window.innerHeight;
            const windowWidth = window.innerWidth;

            // Fade out when scrolling past 30% of the first section
            // Supports both vertical (desktop) and horizontal (mobile) scroll
            if (scrollTop > windowHeight * 0.3 || (isMobile && scrollLeft > windowWidth * 0.3)) {
                dayIndicator.classList.add('hidden');
            } else {
                dayIndicator.classList.remove('hidden');
            }
        });
    </script>
</body>

</html>